<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="color-scheme" content="dark light">
		<link rel="icon" href="assets/pics/logos/hiosbadge.png" type="image/icon">
		<link rel="stylesheet" href="assets/css/style.css" type="text/css">
		<link rel="stylesheet" href="assets/css/ripple.css" type="text/css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
		<title>HiOS | Room Key</title>
		<script src="assets/scripts/links.js"></script>
		<style>
			/* NFC Animation Styles */
			@keyframes nfc-pulse {
				0%, 100% {
					transform: scale(1);
					opacity: 1;
				}
				50% {
					transform: scale(1.05);
					opacity: 0.8;
				}
			}

			@keyframes nfc-glow {
				0%, 100% {
					box-shadow: 0 0 20px rgba(var(--primary-rgb, 0, 97, 166), 0.3);
				}
				50% {
					box-shadow: 0 0 40px rgba(var(--primary-rgb, 0, 97, 166), 0.6);
				}
			}

			@keyframes unlock-success {
				0% {
					transform: scale(1) rotate(0deg);
				}
				25% {
					transform: scale(1.15) rotate(-3deg);
				}
				50% {
					transform: scale(1.15) rotate(3deg);
				}
				75% {
					transform: scale(1.15) rotate(-3deg);
				}
				100% {
					transform: scale(1) rotate(0deg);
				}
			}

			@keyframes countdown-pulse {
				0%, 100% {
					transform: scale(1);
				}
				50% {
					transform: scale(1.1);
				}
			}

			.nfc-container {
				position: relative;
				display: flex;
				justify-content: center;
				align-items: center;
				margin: 32px 0;
			}

			.nfc-icon-wrapper {
				position: relative;
				display: inline-block;
			}

			.nfc-icon {
				font-size: 180px !important;
				color: var(--primary);
				display: block;
				transition: all 0.3s ease;
			}

			.nfc-icon.ready {
				animation: nfc-pulse 2.5s ease-in-out infinite;
			}

			.nfc-icon.unlocking {
				animation: none;
				color: var(--tertiary);
			}

			.nfc-icon.unlocked {
				animation: unlock-success 0.6s ease-out;
				color: #4CAF50;
			}

			/* Ripple rings around NFC icon */
			.nfc-icon-wrapper::before,
			.nfc-icon-wrapper::after {
				content: '';
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				border: 2px solid var(--primary);
				border-radius: 50%;
				opacity: 0;
				pointer-events: none;
			}

			.nfc-icon-wrapper.ready::before {
				width: 200px;
				height: 200px;
				animation: ripple-ring 2.5s ease-out infinite;
			}

			.nfc-icon-wrapper.ready::after {
				width: 240px;
				height: 240px;
				animation: ripple-ring 2.5s ease-out infinite 0.5s;
			}

			@keyframes ripple-ring {
				0% {
					opacity: 0;
					transform: translate(-50%, -50%) scale(0.8);
				}
				50% {
					opacity: 0.3;
				}
				100% {
					opacity: 0;
					transform: translate(-50%, -50%) scale(1);
				}
			}

			.status-badge {
				display: inline-block;
				padding: 8px 16px;
				border-radius: 20px;
				font-size: 14px;
				font-weight: 600;
				margin: 8px 0;
			}

			.status-ready {
				background-color: color-mix(in srgb, var(--primary) 20%, transparent);
				color: var(--primary);
			}

			.status-disabled {
				background-color: color-mix(in srgb, var(--error) 20%, transparent);
				color: var(--error);
			}

			.status-unlocked {
				background-color: color-mix(in srgb, #4CAF50 20%, transparent);
				color: #4CAF50;
			}

			.status-unlocking {
				background-color: color-mix(in srgb, var(--tertiary) 20%, transparent);
				color: var(--tertiary);
			}

			.room-number-display {
				font-size: 72px;
				font-weight: 700;
				color: var(--primary);
				line-height: 1;
				margin: 16px 0;
			}

			.countdown-timer {
				font-size: 28px;
				font-weight: 600;
				color: var(--primary);
				margin: 8px 0;
			}

			.info-grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 16px;
				margin: 16px 0;
			}

			.info-item {
				text-align: center;
			}

			.info-label {
				font-size: 12px;
				text-transform: uppercase;
				opacity: 0.7;
				margin-bottom: 4px;
			}

			.info-value {
				font-size: 18px;
				font-weight: 600;
			}

			/* Progress bar for stay duration */
			.stay-progress {
				width: 100%;
				height: 8px;
				background-color: color-mix(in srgb, var(--primary) 20%, transparent);
				border-radius: 4px;
				overflow: hidden;
				margin: 16px 0;
			}

			.stay-progress-fill {
				height: 100%;
				background-color: var(--primary);
				transition: width 0.5s ease;
			}

			/* Countdown display */
			.unlock-countdown {
				font-size: 64px;
				font-weight: 700;
				color: var(--primary);
				margin: 20px 0;
				animation: countdown-pulse 1s ease-in-out infinite;
			}

			.unlock-countdown.final {
				color: #4CAF50;
			}

			/* Toast notification */
			.toast {
				position: fixed;
				bottom: 80px;
				left: 50%;
				transform: translateX(-50%) translateY(100px);
				background-color: var(--primaryContainer);
				color: var(--onPrimaryContainer);
				padding: 16px 24px;
				border-radius: 25px;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
				opacity: 0;
				transition: all 0.3s ease;
				z-index: 1000;
				max-width: 90%;
			}

			.toast.show {
				transform: translateX(-50%) translateY(0);
				opacity: 1;
			}

			/* Unlock button */
			.unlock-button {
				width: 100%;
				max-width: 300px;
				padding: 16px 32px;
				font-size: 18px;
				font-weight: 600;
				border-radius: 50px;
				border: none;
				background-color: var(--primary);
				color: var(--onPrimary);
				cursor: pointer;
				transition: all 0.3s ease;
				margin: 16px auto;
				display: block;
			}

			.unlock-button:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
			}

			.unlock-button:active {
				transform: translateY(0);
			}

			.unlock-button:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			.unlock-button:disabled:hover {
				transform: none;
			}
		</style>
	</head>
	<body>
		<!--The universal background image-->
		<div class="background-wrapper">
			<div class="background-image"></div>
		</div>
		<main class="container mt-4 mb-5">
			<!-- Header Card -->
			<div class="card full">
				<div class="card-body">
					<div class="top-container">
						<h1 class="blue-h2"><span class="titleIcon material-symbols-rounded">key</span>Room Key</h1>
					</div>
				</div>
			</div>

			<!-- Room Info Card -->
			<div class="card mt-2 full">
				<div class="card-body text-center">
					<p class="info-label">Your Room</p>
					<div class="room-number-display" id="roomNumber">201</div>
					<p id="guestName" style="font-size: 18px; margin: 8px 0;">Welcome, Guest</p>
					
					<!-- Stay Progress -->
					<div class="stay-progress">
						<div class="stay-progress-fill" id="stayProgress" style="width: 33%;"></div>
					</div>
					
					<!-- Stay Info Grid -->
					<div class="info-grid">
						<div class="info-item">
							<div class="info-label">Check-in</div>
							<div class="info-value" id="checkinDate">Mon, Jan 15</div>
							<div style="font-size: 14px; opacity: 0.7;" id="checkinTime">2:00 PM</div>
						</div>
						<div class="info-item">
							<div class="info-label">Check-out</div>
							<div class="info-value" id="checkoutDate">Wed, Jan 17</div>
							<div style="font-size: 14px; opacity: 0.7;" id="checkoutTime">11:00 AM</div>
						</div>
					</div>
					
					<!-- Countdown -->
					<div class="countdown-timer" id="countdown">2 nights remaining</div>
				</div>
			</div>

			<!-- NFC Key Card -->
			<div class="card mt-2 full">
				<div class="card-body text-center">
					<span class="status-badge status-ready" id="nfcStatus">Ready to Unlock</span>
					
					<!-- NFC Icon (replaces GIF) -->
					<div class="nfc-container">
						<div class="nfc-icon-wrapper ready" id="nfcIconWrapper">
							<span class="material-symbols-rounded nfc-icon ready" id="nfcIcon">nfc</span>
						</div>
					</div>
					
					<!-- Countdown Display (hidden by default) -->
					<div id="countdownDisplay" style="display: none;">
						<div class="unlock-countdown" id="unlockCountdown">3</div>
					</div>
					
					<h5 class="card-title" id="unlockTitle">Tap to Unlock</h5>
					<p class="card-text" id="unlockSubtitle">Press the button below to unlock your room</p>
					
					<!-- Unlock Button -->
					<button 
						class="ripple-button unlock-button" 
						id="unlockButton"
						onclick="startUnlockSequence()">
						<span class="material-symbols-rounded" style="vertical-align: middle; margin-right: 8px;">lock_open</span>
						Unlock Room
					</button>
				</div>
			</div>

			<!-- NFC Status Warning (if disabled) -->
			<div class="card mt-2 full" id="nfcWarning" style="display: none;">
				<div class="card-body">
					<div style="display: flex; align-items: center; gap: 12px;">
						<span class="material-symbols-rounded" style="color: var(--error); font-size: 32px;">warning</span>
						<div style="flex: 1;">
							<h6 style="margin: 0 0 4px 0; font-weight: 600;">NFC is Disabled</h6>
							<p style="margin: 0; font-size: 14px; opacity: 0.8;">Enable NFC in your device settings to use your digital room key</p>
						</div>
					</div>
				</div>
			</div>

			<!-- Info Card -->
			<div class="card mt-2 full">
				<div class="card-body">
					<h6><span class="material-symbols-rounded helpcenterIcons">info</span> You need NFC to be switched on to use your digital room key</h6>
					<p style="font-size: 14px; margin: 8px 0 0 0; opacity: 0.8;">
						If NFC doesn't work, please contact the front desk for a physical key card.
					</p>
				</div>
			</div>
		</main>

		<!-- Toast Notification -->
		<div class="toast" id="toast">
			<span id="toastMessage">Room unlocked successfully!</span>
		</div>

		<script src="assets/scripts/background.js"></script>
		<script src="assets/scripts/ripple.js"></script>
		<script src="assets/scripts/bootstrap-shim.js"></script>

		<script>
			// Room data (in production, fetch from server/localStorage)
			let roomData = {
				roomNumber: '201',
				guestName: 'Welcome, Guest',
				checkinDate: new Date(),
				checkoutDate: new Date(Date.now() + (2 * 24 * 60 * 60 * 1000)), // 2 days from now
				nfcEnabled: true
			};

			let isUnlocking = false;

			// Initialize on page load
			document.addEventListener('DOMContentLoaded', function() {
				loadRoomData();
				checkNFCStatus();
				updateCountdown();
				
				// Update countdown every minute
				setInterval(updateCountdown, 60000);
			});

			function loadRoomData() {
				// Load from localStorage if available
				const savedData = localStorage.getItem('hiosRoomData');
				if (savedData) {
					const parsed = JSON.parse(savedData);
					roomData.roomNumber = parsed.roomNumber || roomData.roomNumber;
					roomData.guestName = parsed.guestName || roomData.guestName;
					if (parsed.checkinDate) roomData.checkinDate = new Date(parsed.checkinDate);
					if (parsed.checkoutDate) roomData.checkoutDate = new Date(parsed.checkoutDate);
				}

				// Update UI
				document.getElementById('roomNumber').textContent = roomData.roomNumber;
				document.getElementById('guestName').textContent = roomData.guestName;
				
				// Format dates
				const dateOptions = { weekday: 'short', month: 'short', day: 'numeric' };
				const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true };
				
				document.getElementById('checkinDate').textContent = 
					roomData.checkinDate.toLocaleDateString('en-US', dateOptions);
				document.getElementById('checkinTime').textContent = 
					roomData.checkinDate.toLocaleTimeString('en-US', timeOptions);
				
				document.getElementById('checkoutDate').textContent = 
					roomData.checkoutDate.toLocaleDateString('en-US', dateOptions);
				document.getElementById('checkoutTime').textContent = 
					roomData.checkoutDate.toLocaleTimeString('en-US', timeOptions);
				
				// Update progress bar
				updateStayProgress();
			}

			function updateStayProgress() {
				const now = new Date();
				const totalStay = roomData.checkoutDate - roomData.checkinDate;
				const elapsed = now - roomData.checkinDate;
				const progress = Math.min(Math.max((elapsed / totalStay) * 100, 0), 100);
				
				document.getElementById('stayProgress').style.width = progress + '%';
			}

			function updateCountdown() {
				const now = new Date();
				const timeLeft = roomData.checkoutDate - now;
				const daysLeft = Math.ceil(timeLeft / (1000 * 60 * 60 * 24));
				
				let countdownText;
				if (daysLeft < 0) {
					countdownText = 'Stay has ended';
				} else if (daysLeft === 0) {
					countdownText = 'Check-out today';
				} else if (daysLeft === 1) {
					countdownText = 'Last night of stay';
				} else {
					countdownText = `${daysLeft} nights remaining`;
				}
				
				document.getElementById('countdown').textContent = countdownText;
			}

			function checkNFCStatus() {
				// In a real app, check actual NFC status
				// For now, we'll simulate it
				if (!roomData.nfcEnabled) {
					showNFCWarning();
				}
			}

			function showNFCWarning() {
				document.getElementById('nfcWarning').style.display = 'block';
				document.getElementById('nfcStatus').textContent = 'NFC Disabled';
				document.getElementById('nfcStatus').className = 'status-badge status-disabled';
				
				const nfcIcon = document.getElementById('nfcIcon');
				const nfcIconWrapper = document.getElementById('nfcIconWrapper');
				nfcIcon.classList.remove('ready');
				nfcIconWrapper.classList.remove('ready');
			}

			// Main unlock sequence with countdown
			function startUnlockSequence() {
				if (isUnlocking) return; // Prevent multiple clicks
				
				isUnlocking = true;
				const unlockButton = document.getElementById('unlockButton');
				const nfcIcon = document.getElementById('nfcIcon');
				const nfcIconWrapper = document.getElementById('nfcIconWrapper');
				const nfcStatus = document.getElementById('nfcStatus');
				const unlockTitle = document.getElementById('unlockTitle');
				const unlockSubtitle = document.getElementById('unlockSubtitle');
				const countdownDisplay = document.getElementById('countdownDisplay');
				const unlockCountdown = document.getElementById('unlockCountdown');
				
				// Disable button
				unlockButton.disabled = true;
				
				// Change to unlocking state
				nfcIcon.classList.remove('ready');
				nfcIconWrapper.classList.remove('ready');
				nfcIcon.classList.add('unlocking');
				nfcStatus.textContent = 'Preparing to Unlock';
				nfcStatus.className = 'status-badge status-unlocking';
				unlockTitle.textContent = 'Get Ready...';
				unlockSubtitle.textContent = 'Hold your phone near the door handle';
				
				// Show countdown after 1 second
				setTimeout(() => {
					countdownDisplay.style.display = 'block';
					unlockTitle.textContent = 'Unlocking in...';
					
					let count = 3;
					unlockCountdown.textContent = count;
					
					const countdownInterval = setInterval(() => {
						count--;
						if (count > 0) {
							unlockCountdown.textContent = count;
						} else {
							clearInterval(countdownInterval);
							unlockCountdown.classList.add('final');
							unlockCountdown.textContent = 'GO!';
							
							// Trigger unlock after showing GO!
							setTimeout(() => {
								performUnlock();
							}, 500);
						}
					}, 1000);
				}, 1000);
			}

			function performUnlock() {
				const nfcIcon = document.getElementById('nfcIcon');
				const nfcStatus = document.getElementById('nfcStatus');
				const unlockTitle = document.getElementById('unlockTitle');
				const unlockSubtitle = document.getElementById('unlockSubtitle');
				const countdownDisplay = document.getElementById('countdownDisplay');
				const unlockCountdown = document.getElementById('unlockCountdown');
				const unlockButton = document.getElementById('unlockButton');
				
				// Hide countdown
				countdownDisplay.style.display = 'none';
				unlockCountdown.classList.remove('final');
				
				// Unlocking animation
				nfcIcon.classList.remove('unlocking');
				nfcIcon.classList.add('unlocked');
				nfcStatus.textContent = 'Unlocked!';
				nfcStatus.className = 'status-badge status-unlocked';
				unlockTitle.textContent = 'Door Unlocked';
				unlockSubtitle.textContent = 'Welcome to Room ' + roomData.roomNumber;
				
				showToast('Room ' + roomData.roomNumber + ' unlocked successfully!');
				
				// Log unlock event
				logUnlockEvent();
				
				// Reset after 4 seconds
				setTimeout(() => {
					resetUnlockState();
				}, 4000);
			}

			function resetUnlockState() {
				const nfcIcon = document.getElementById('nfcIcon');
				const nfcIconWrapper = document.getElementById('nfcIconWrapper');
				const nfcStatus = document.getElementById('nfcStatus');
				const unlockTitle = document.getElementById('unlockTitle');
				const unlockSubtitle = document.getElementById('unlockSubtitle');
				const unlockButton = document.getElementById('unlockButton');
				
				nfcIcon.classList.remove('unlocked');
				nfcIcon.classList.add('ready');
				nfcIconWrapper.classList.add('ready');
				nfcStatus.textContent = 'Ready to Unlock';
				nfcStatus.className = 'status-badge status-ready';
				unlockTitle.textContent = 'Tap to Unlock';
				unlockSubtitle.textContent = 'Press the button below to unlock your room';
				unlockButton.disabled = false;
				isUnlocking = false;
			}

			function logUnlockEvent() {
				// Log unlock event (in production, send to server)
				const unlockHistory = JSON.parse(localStorage.getItem('unlockHistory') || '[]');
				unlockHistory.push({
					room: roomData.roomNumber,
					timestamp: new Date().toISOString()
				});
				localStorage.setItem('unlockHistory', JSON.stringify(unlockHistory));
			}

			function showToast(message) {
				const toast = document.getElementById('toast');
				const toastMessage = document.getElementById('toastMessage');
				
				toastMessage.textContent = message;
				toast.classList.add('show');
				
				setTimeout(() => {
					toast.classList.remove('show');
				}, 3000);
			}

			// Save room data function (call this when data changes)
			function saveRoomData() {
				localStorage.setItem('hiosRoomData', JSON.stringify({
					roomNumber: roomData.roomNumber,
					guestName: roomData.guestName,
					checkinDate: roomData.checkinDate.toISOString(),
					checkoutDate: roomData.checkoutDate.toISOString()
				}));
			}

			// Example: Set custom room data
			function setRoomData(roomNumber, guestName, checkinDate, checkoutDate) {
				roomData.roomNumber = roomNumber;
				roomData.guestName = guestName;
				roomData.checkinDate = new Date(checkinDate);
				roomData.checkoutDate = new Date(checkoutDate);
				
				saveRoomData();
				loadRoomData();
			}

			// Example usage:
			// setRoomData('305', 'John Smith', '2025-02-01T14:00', '2025-02-05T11:00');
		</script>
	</body>
</html>