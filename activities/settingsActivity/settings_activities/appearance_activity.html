<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="color-scheme" content="dark light">
        <link rel="icon" href="../../../assets/pics/logos/hiosbadge.png" type="image/icon type">
        <link rel="stylesheet" href="../../../assets/css/style.css" type="text/css">
        <link rel="stylesheet" href="../../../assets/css/ripple.css" type="text/css">
        <link rel="stylesheet" href="../../../assets/css/toggle.css" type="text/css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <script src="../../../assets/scripts/links.js"></script>
        <title>HiOS |</title>
    </head>
    <body>
        <!--The universal background image-->
		<div class="background-wrapper">
			<div class="background-image"></div>
		</div>
        <main class="container mt-4 mb-5">
            <div class="card mt-3 full">
                <div class="card-body">
                    <div class="top-container">
                        <h1 class="blue-h2"><span class="titleIcon material-symbols-rounded">palette</span>Appearance</h1>
                        <p id="para">Customise the appearance of HiOSMobile to your taste below.</p>
                    </div>
                </div>
            </div>
            <div class="card mt-2 joinTop">
                <div class="card-body">
                    <div id="background-selector">
						<h1 class="card-title">App Background</h1>
						<h3 class="card-subtitle mb-2">Our backgrounds</h3>
						<select class="form-select" id="backgroundSelect">
							<option value="default-light">Default</option>
							<option value="default-dark">Default (Night)</option>
							<option value="city" data-theme="city">City</option>
							<option value="night-sky" data-theme="night-sky">Night Sky</option>
							<option value="morocco" data-theme="morocco">Morocco</option>
							<option value="clouds" data-theme="clouds">Cloudy Sunrise</option>
							<option value="blossoms" data-theme="blossoms">Blossoms</option>
                            <option value="london" data-theme="london">London</option>
						</select>
					</div>
                </div>
            </div>
            <!--div class="card joinMiddle">
                <div class="card-body">
                    <div id="background-upload">
						<h3 class="card-subtitle mb-2">Your background</h2>
						<input type="file" id="uploadBackground" accept="image/*">
					</div>
                </div>
            </div-->
            <div class="card joinBottom">
                <div class="card-body">
                    <h1 class="card-title">App Colours</h1>
                    <div class="translucentAboutBox" style="margin-top: 8px; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; justify-content: flex-start;">
                            <label class="form-check-label ms-2" for="autoColourToggle" style="margin-right: auto;">Auto Wallpaper Colours</label>
                            <label class="switch" style="margin-left: auto;">
                                <input type="checkbox" id="autoColourToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <select class="form-select" id="genericColourSelect">
                        <option value="default-light">Blue (Default)</option>
                        <option value="generic-green">Green</option>
                        <option value="generic-cyan">Cyan</option>
                        <option value="generic-orange">Orange</option>
                    </select>

                    <div class="translucentAboutBox" style="margin-top: 12px; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; justify-content: flex-start;">
                            <label class="form-check-label ms-2" for="backgroundToggle" style="margin-right: auto;">Background Image</label>
                            <label class="switch" style="margin-left: auto;">
                                <input type="checkbox" id="backgroundToggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <div class="translucentAboutBox" style="margin-top: 8px;">
                        <div style="display: flex; align-items: center; justify-content: flex-start;">
                            <label class="form-check-label ms-2" for="acrylicToggle" style="margin-right: auto;">Acrylic</label>
                            <label class="switch" style="margin-left: auto;">
                                <input type="checkbox" id="acrylicToggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>

                </div>
            </div>
        </main>
        <script src="../../../assets/scripts/background.js"></script>
        <script src="../../../assets/scripts/ripple.js"></script>

        <!-- UPDATED SCRIPT BLOCK -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const backgroundSelect = document.getElementById('backgroundSelect');
                const autoToggle = document.getElementById('autoColourToggle');
                const genericColourSelect = document.getElementById('genericColourSelect');
                
                const backgroundToggle = document.getElementById('backgroundToggle');
                const acrylicToggle = document.getElementById('acrylicToggle');

                // --- 1. SET INITIAL STATE ---
                // Read from TWO different localStorage keys
                const savedWallpaper = localStorage.getItem('hiosWallpaperTheme') || 'default-light';
                const savedColor = localStorage.getItem('hiosColorTheme') || 'default-light';
                const isAuto = localStorage.getItem('hiosAutoColor') !== 'false'; // default to true
                
                // New toggles
                const storedBg = localStorage.getItem('hiosBackgroundEnabled');
                const storedAcrylic = localStorage.getItem('hiosAcrylicEnabled');
                const isBackgroundEnabled = storedBg === null ? true : storedBg === 'true'; // default on
                const isAcrylicEnabled = storedAcrylic === null ? true : storedAcrylic === 'true'; // default on
                
                const effectiveAuto = isBackgroundEnabled ? isAuto : false;

                autoToggle.checked = effectiveAuto;
                genericColourSelect.disabled = effectiveAuto;
                backgroundToggle.checked = isBackgroundEnabled;
                acrylicToggle.checked = isBackgroundEnabled ? isAcrylicEnabled : false;
                backgroundSelect.disabled = !isBackgroundEnabled;
                autoToggle.disabled = !isBackgroundEnabled;
                acrylicToggle.disabled = !isBackgroundEnabled;

                // Set dropdowns to the correct saved values
                if (backgroundSelect.querySelector(`[value="${savedWallpaper}"]`)) {
                    backgroundSelect.value = savedWallpaper;
                }
                if (genericColourSelect.querySelector(`[value="${savedColor}"]`)) {
                    genericColourSelect.value = savedColor;
                }

                // --- 2. ADD EVENT LISTENERS ---

                // Auto Toggle clicked
                autoToggle.addEventListener('change', () => {
                    const isChecked = autoToggle.checked;
                    localStorage.setItem('hiosAutoColor', isChecked);
                    genericColourSelect.disabled = isChecked;
                    applyTheme();
                });

                // Background dropdown changed
                backgroundSelect.addEventListener('change', () => {
                    applyTheme();
                });

                // Color dropdown changed
                genericColourSelect.addEventListener('change', () => {
                    if (!autoToggle.checked) {
                        applyTheme();
                    }
                });

                // Background image toggle listener
                backgroundToggle.addEventListener('change', () => {
                    const isChecked = backgroundToggle.checked;
                    localStorage.setItem('hiosBackgroundEnabled', isChecked);
                    backgroundSelect.disabled = !isChecked;
                    autoToggle.disabled = !isChecked;
                    acrylicToggle.disabled = !isChecked;

                    if (!isChecked) {
                        autoToggle.checked = false;
                        acrylicToggle.checked = false;
                        localStorage.setItem('hiosAutoColor', false);
                        localStorage.setItem('hiosAcrylicEnabled', false);
                        genericColourSelect.disabled = false;
                    } else {
                        const savedAuto = localStorage.getItem('hiosAutoColor');
                        const savedAcrylicPref = localStorage.getItem('hiosAcrylicEnabled');
                        const autoOn = savedAuto === null ? true : savedAuto !== 'false';
                        const acrylicOn = savedAcrylicPref === null ? true : savedAcrylicPref === 'true';
                        autoToggle.checked = autoOn;
                        acrylicToggle.checked = acrylicOn;
                        genericColourSelect.disabled = autoOn ? true : false;
                    }

                    applyTheme();
                    location.reload();
                });

                // Acrylic toggle listener
                acrylicToggle.addEventListener('change', () => {
                    const isChecked = acrylicToggle.checked;
                    localStorage.setItem('hiosAcrylicEnabled', isChecked);
                    location.reload();
                });

                // --- 3. APPLY THEME FUNCTION ---
                function applyTheme() {
                    const wallpaperName = backgroundSelect.value;
                    let colorName = '';

                    if (autoToggle.checked) {
                        // Auto is ON: Color matches wallpaper
                        colorName = wallpaperName;
                    } else {
                        // Auto is OFF: Color comes from generic dropdown
                        colorName = genericColourSelect.value;
                    }
                    
                    // Save to TWO separate localStorage keys
                    localStorage.setItem('hiosWallpaperTheme', wallpaperName);
                    localStorage.setItem('hiosColorTheme', colorName);
                    
                    // Call the global function from background.js to update the page
                    if (typeof themeSwitcher === 'function') {
                        themeSwitcher();
                    } else {
                        console.error('themeSwitcher() function not found.');
                    }
                }
            });
        </script>
    
		<script src="../../../assets/scripts/bootstrap-shim.js"></script>
</body>
</html>
