<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="color-scheme" content="dark light">
        <link rel="icon" href="../../../assets/pics/logos/hiosbadge.png" type="image/icon type">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
        <link rel="stylesheet" href="../../../assets/css/style.css" type="text/css">
        <link rel="stylesheet" href="../../../assets/css/ripple.css" type="text/css">
        <link rel="stylesheet" href="../../../assets/css/toggle.css" type="text/css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <script src="../../../assets/scripts/links.js"></script>
        <title>HiOS |</title>
    </head>
    <body>
        <!--The universal background image-->
		<div class="background-wrapper">
			<div class="background-image"></div>
		</div>
        <main class="container mt-4 mb-5">
            <div class="card mt-3 full">
                <div class="card-body">
                    <div class="top-container">
                        <h1 class="blue-h2"><span class="titleIcon material-symbols-rounded">palette</span>Appearance</h1>
                        <p id="para">Customise the appearance of HiOSMobile to your taste below.</p>
                    </div>
                </div>
            </div>
            <div class="card mt-2 joinTop">
                <div class="card-body">
                    <div id="background-selector">
						<h1 class="card-title">App Background</h1>
						<h3 class="card-subtitle mb-2">Our backgrounds</h3>
						<select class="form-select" id="backgroundSelect">
							<option value="default-light">Default</option>
							<option value="default-dark">Default (Night)</option>
							<option value="city" data-theme="city">City</option>
							<option value="night-sky" data-theme="night-sky">Night Sky</option>
							<option value="morocco" data-theme="morocco">Morocco</option>
							<option value="clouds" data-theme="clouds">Cloudy Sunrise</option>
							<option value="blossoms" data-theme="blossoms">Blossoms</option>
                            <option value="london" data-theme="london">London</option>
						</select>
					</div>
                </div>
            </div>
            <!--div class="card joinMiddle">
                <div class="card-body">
                    <div id="background-upload">
						<h3 class="card-subtitle mb-2">Your background</h2>
						<input type="file" id="uploadBackground" accept="image/*">
					</div>
                </div>
            </div-->
            <div class="card joinBottom">
                <div class="card-body">
                    <h1 class="card-title">App Colours</h1>
                    <div class="mb-2" style="display: flex; align-items: center; justify-content: flex-start;">
                        <label class="form-check-label ms-2" for="autoColourToggle" style="margin-right: auto;">Auto Wallpaper Colours</label>
                        <label class="switch" style="margin-left: auto;">
                            <input type="checkbox" id="autoColourToggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <select class="form-select" id="genericColourSelect">
                        <option value="default-light">Blue (Default)</option>
                        <option value="generic-green">Green</option>
                        <option value="generic-cyan">Cyan</option>
                        <option value="generic-orange">Orange</option>
                    </select>
                </div>
            </div>
        </main>
        <script src="../../../assets/scripts/background.js"></script>
        <script src="../../../assets/scripts/ripple.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YpPczugYYLkLMkpBqlbQlHvpcRQlzhZKHXYkJGVxHf39Eo7RjVMqljJutlnWsZPd" crossorigin="anonymous"></script>

                <script>
            document.addEventListener('DOMContentLoaded', () => {
                const backgroundSelect = document.getElementById('backgroundSelect');
                const autoToggle = document.getElementById('autoColourToggle');
                const genericColourSelect = document.getElementById('genericColourSelect');
                const bgImage = document.querySelector('.background-image');

                // --- 1. SET INITIAL STATE ---
                const savedTheme = localStorage.getItem('hiosTheme') || 'default-light';
                const isAuto = localStorage.getItem('hiosAutoColor') !== 'false'; // default to true
                
                autoToggle.checked = isAuto;
                genericColourSelect.disabled = isAuto;

                // Set dropdowns to the correct saved value
                if (isAuto) {
                    if (backgroundSelect.querySelector(`[value="${savedTheme}"]`)) {
                        backgroundSelect.value = savedTheme;
                    }
                } else {
                    if (genericColourSelect.querySelector(`[value="${savedTheme}"]`)) {
                        genericColourSelect.value = savedTheme;
                    }
                }

                // --- 2. ADD EVENT LISTENERS ---

                // Auto Toggle clicked
                autoToggle.addEventListener('change', () => {
                    const isChecked = autoToggle.checked;
                    localStorage.setItem('hiosAutoColor', isChecked);
                    genericColourSelect.disabled = isChecked;

                    // Immediately apply the new theme
                    applyTheme();
                });

                // Background dropdown changed
                backgroundSelect.addEventListener('change', () => {
                    if (autoToggle.checked) {
                        applyTheme();
                    }
                });

                // Color dropdown changed
                genericColourSelect.addEventListener('change', () => {
                    if (!autoToggle.checked) {
                        applyTheme();
                    }
                });

                // --- 3. APPLY THEME FUNCTION ---
                function applyTheme() {
                    let themeName = 'default-light';

                    if (autoToggle.checked) {
                        // Use background theme
                        themeName = backgroundSelect.value;
                    } else {
                        // Use generic color theme
                        themeName = genericColourSelect.value;
                    }
                    
                    // Save the new theme
                    localStorage.setItem('hiosTheme', themeName);
                    
                    // Call the global function from background.js to update the page
                    if (typeof themeSwitcher === 'function') {
                        themeSwitcher();
                    } else {
                        console.error('themeSwitcher() function not found.');
                    }
                }
            });
        </script>
    </body>
</html>